<app-layout>
  <ng-template #customTabButtons>
    <ul class="navbar-nav">
      <li class="nav-item"><button [disabled]="mode!='edit'"(click)="openDialogAfip()"  class="navbar-brand btn"><mat-icon class="align-middle">check_circle_outline</mat-icon></button></li>
    </ul>
  </ng-template>
  <div toolbar >
    <app-toolbar-form (print)="print()" [toolbarTemplate]="customTabButtons"  [mode]="mode" > </app-toolbar-form>
  </div>
    <h3>Factura</h3>
    <div>
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div>
          <input type="hidden" formControlName="id" [(ngModel)]="entity.id">
          <input type="hidden" formControlName="idEmpresa" [(ngModel)]="entity.idEmpresa">
          <input type="hidden" formControlName="IdSucursal" [(ngModel)]="entity.idSucursal">
          <input type="hidden" formControlName="IdArea" [(ngModel)]="entity.idArea">
          <input type="hidden" formControlName="IdSeccion" [(ngModel)]="entity.idSeccion">
          <input type="hidden" formControlName="IdTransaccion" [(ngModel)]="entity.idTransaccion">
          <input type="hidden" formControlName="TotalNeto" [(ngModel)]="entity.totalNeto">
          <input type="hidden" formControlName="TotalDescuento" [(ngModel)]="entity.totalDescuento">
          <input type="hidden" formControlName="TotalGravado" [(ngModel)]="entity.totalGravado">
          <input type="hidden" formControlName="TotalNoGravado" [(ngModel)]="entity.totalNoGravado">
          <input type="hidden" formControlName="TotalExento" [(ngModel)]="entity.totalExento">
          <input type="hidden" formControlName="TotalIva" [(ngModel)]="entity.totalIva">
          <input type="hidden" formControlName="TotalOTributos" [(ngModel)]="entity.totalOTributos">
          
        </div>
        <div class="form-group row">
            <div class="col-xs-2 col-lg-2">
                <label for="tipo">Tipo</label>
                <select class="form-control" formControlName = "Tipo" name="IdCuenta" [(ngModel)]="entity.tipo">
                  <option *ngFor="let item of tipoFactura" [ngValue]="item.id" [selected]="entity.tipo === item.id">{{item.nombre}} </option>
                </select>   
           </div>     
                <div class="col-xs-1 col-lg-1">
                <label for="fechaVenc">Letra</label>
                <select class="form-control" formControlName = "Letra" name="Letra" [(ngModel)]="entity.letra">
                  <option *ngFor="let item of letras"  [selected]="entity.letra === item">{{item}} </option>
               </select>    
              </div>
             <div class="col-xs-1 col-md-1">
                <label for="Pe">Numero</label>
                <input type="number" class="form-control" id="Pe" formControlName = "Pe" required name="Fecha" [(ngModel)]="entity.pe">
           </div>
           <div class="col-xs-2 col-md-2"> 
               <label>_</label>               
               <input type="number" class="form-control" id="Numero" formControlName = "Numero" required name="Numero" [(ngModel)]="entity.numero">
          </div>
          </div>
        <div class="form-group row">
          <div class="col-xs-2 col-lg-2">
               <label for="fecha">Fecha</label>
               <input type="date" class="form-control" id="Fecha" formControlName = "Fecha" required name="Fecha" [ngModel]="entity.fecha | date:'yyyy-MM-dd'">
          </div>
          <div class="col-xs-2 col-lg-2">
            <label for="fechaVenc">Fecha Venc</label>
            <input type="date" class="form-control" id="FechaVencimiento" formControlName = "FechaVencimiento" required name="Fecha" [ngModel]="entity.fechaVencimiento | date:'yyyy-MM-dd'">
       </div>
        </div>        
        <div class="form-group row">
            <div class="col-xs-5 col-lg-5">
                <label for="idCuenta">Cuenta</label>
                <select class="form-control" formControlName = "IdCuenta" name="IdCuenta" [(ngModel)]="entity.idCuenta">
                   <option *ngFor="let item of sujetos" [ngValue]="item.id" [selected]="entity.idCuenta === item.id">{{item.nombre}} </option>
                </select>                
               </div>  
        </div>
        <div class="form-group row">
          <div class="col-6">
          <table formArrayName="MedioPago" class="table table-sm">            
            <tr class="row">
              <th colspan="3">Medio de Pago<a class="btn" (click)="addMedioPago()" ><span class="material-icons">add</span></a></th>
            </tr>            
            <tr class="row">                
                <th class="col-9">Nombre</th>
                <th class="col-2">Importe</th>                
                <th class="col-1"></th>
            </tr>               
            <tr class="row" *ngFor="let item of mediopago.controls; let i=index"  [formGroupName]="i">                
                <td class="col-9"><input type="hidden" formControlName="Id"/>
                    <select class="form-control" formControlName = "IdCuentaMayor" name="IdCuentaMayor" [(ngModel)]="entity.medioPago[i].idCuentaMayor">
                       <option *ngFor="let item of mediosPagos" [ngValue]="item.id" [selected]="entity.medioPago[i].idCuentaMayor === item.id">{{item.nombre}} </option>
                    </select>
                    <input type="hidden" class="form-control" formControlName = "Concepto" required  ></td>
                <td class="col-2"><input type="text" class="form-control" formControlName = "Importe" required  ></td>
                <td class="col-1"><a *ngIf="mediopago.controls.length > 1" (click)="removeDetalle(i)"><i class="material-icons btn">delete</i></a></td>            
            </tr>           
        </table> 
         </div>
      </div>
        <div class="form-group row">
            <div class="col-1">   
                <a class="btn" (click)="addDetalle()" ><span class="material-icons">add</span></a>    
             </div>
             <div class="col-1">   
              <a class="btn" (click)="openDialog()" ><span class="material-icons">search</span></a>
            </div> 
        </div>
        <div class="form-group row">
          <div class="col-12">          
           <table formArrayName="Detalle" class="table table-sm">            
            <tr class="row">
                <th class="col-1">Codigo</th>
                <th class="col-1">Cantidad</th>
                <th class="col-6">Nombre</th>
                <th class="col-1">Precio</th>
                <th class="col-1">Bon.</th>
                <th class="col-1">Total</th>
                <th class="col-1"></th>
            </tr>               
            <tr class="row" *ngFor="let item of detalle.controls; let i=index"  [formGroupName]="i">          
                <td class="col-1"><input type="text" class="form-control" formControlName = "IdArticulo" required  [(ngModel)]="entity.detalle[i].idArticulo"></td>
                <td class="col-1"><input type="number" class="form-control" formControlName = "Cantidad" required  [(ngModel)]="entity.detalle[i].cantidad"></td>
                <td class="col-6"><input type="text" class="form-control" formControlName = "Concepto" required  [(ngModel)]="entity.detalle[i].concepto"></td>
                <td class="col-1"><input type="number" class="form-control" formControlName = "Precio" required  [(ngModel)]="entity.detalle[i].precio"></td>
                <td class="col-1"></td>
                <td class="col-1"><input type="number" class="form-control" id="Total" formControlName = "Total" [readonly]="true" [(ngModel)]="entity.detalle[i].total"></td>
                <td class="col-1"><a (click)="removeDetalle(i)"><i class="material-icons btn">delete</i></a></td>            
            </tr>
            <tr class="row">
                <td class="col-1"></td>
                <td class="col-1"></td>
                <td class="col-6"></td>
                <td class="col-1"></td>
                <td class="col-1"></td>            
                <td class="col-1"><div [formGroup]="form"><input  class="form-control" formControlName="Total" [readonly]="true" [(ngModel)]="entity.total"></div></td>
                <td class="col-1"></td>
              </tr>
           </table> 
          </div>
        </div>
        <div class="row">
          <div class="col-1">   
            <button type="submit" class="btn btn-primary" [disabled]="!form.valid">Aceptar</button>    
          </div> 
          <div class="col-md-1">
            <button type="menu" class="btn" (click)="goBack()">Cancelar</button>
          </div>  
         </div>    
      </form> 
    </div>
    </app-layout>
    



